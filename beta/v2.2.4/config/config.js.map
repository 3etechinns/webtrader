{"version":3,"sources":["../../../../src/config/config.es6"],"names":["win","win_view","initConfigWindow","root","i18n","state","init_state","bind","createBlankWindow","title","resizable","collapsable","minimizable","maximizable","modal","ignoreTileAction","open","config","local_storage","get","app_id","websocket_url","socket_url","oauth_url","replace","close","unbind","dialog","remove","buttons","text","icons","primary","click","apply","reset","lang","value","set","reload_page","growl","notice","message","setTimeout","window","location","reload","init","$menuLink","moveToTop"],"mappings":"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","file":"config.js","sourcesContent":["/**\n* Created by arnab on 5/12/16.\n*/\nimport $ from 'jquery';\nimport windows from '../windows/windows';\nimport rv from '../common/rivetsExtra';\nimport liveapi from '../websockets/binary_websockets';\nimport _ from 'lodash';\nimport '../common/util';\nimport html from 'text!./config.html';\nimport 'css!./config.css';\n\nlet win = null, win_view = null;\n\nconst initConfigWindow = () => {\n   const root = $(html).i18n();\n   const state = init_state(root);\n   win_view = rv.bind(root[0], state);\n\n   win = windows.createBlankWindow(root, {\n      title: 'Change Backend Server'.i18n(),\n      resizable: false,\n      collapsable: false,\n      minimizable: false,\n      maximizable: false,\n      modal: true,\n      ignoreTileAction:true,\n      open: () => {\n         const config = local_storage.get('config');\n         state.app_id = liveapi.app_id;\n         state.websocket_url = liveapi.socket_url;\n         if(config && config.oauth_url) state.oauth_url = _.replace(_.replace(config.oauth_url || '', 'https://', ''), '/oauth2/authorize', '');\n      },\n      close: () => {\n         win_view && win_view.unbind();\n         win && win.dialog('destroy').remove();\n         win_view = win = null;\n      },\n      buttons: [\n         {\n            text: 'Apply'.i18n(),\n            icons: { primary: 'ui-icon-check' },\n            click: state.apply\n         },\n         {\n            text: 'Reset to Defaults'.i18n(),\n            icons: { primary: 'ui-icon-refresh' },\n            click: state.reset\n         }\n      ]\n   });\n\n   win.dialog( 'open' );\n}\n\nconst init_state = (root) => {\n   const state = {\n      websocket_url: liveapi.socket_url,\n      oauth_url: 'oauth.binary.com',\n      app_id: liveapi.app_id\n   };\n\n   state.apply = () => {\n      const lang = (local_storage.get('i18n') || {value:'en'}).value;\n      const config = {\n         websocket_url: 'wss://' + state.websocket_url + '/websockets/v3?l=' + lang,\n         oauth_url: 'https://' + state.oauth_url + '/oauth2/authorize',\n         app_id: state.app_id\n      }\n      local_storage.set('config', config);\n      state.reload_page();\n   }\n\n   state.reset = () => {\n      local_storage.remove('config');\n      state.reload_page();\n   }\n\n   state.reload_page = () => {\n      $.growl.notice({message: 'Config changes successful.<br/>Reloading page ...'.i18n()});\n      setTimeout(() => {\n         window.location.reload();\n      }, 900);\n   }\n\n   return state;\n}\n\n\nexport const init = ($menuLink) => {\n   $menuLink.click(() => {\n      if (!win)\n         initConfigWindow();\n      else\n         win.moveToTop();\n   });\n}\n\nexport default { init }\n"]}