define(["jquery","moment","text!navigation/navigation.html","css!navigation/navigation.css","common/util"],function(a,b,c){"use strict";function d(){a("#nav-menu li > ul li").each(function(){var b=a(this);b.hasClass("update-list-item-handlers")||(b.addClass("update-list-item-handlers"),b.on("click",function(){var b=a(this),c=b.find("ul").length>0;c||b.parent("ul").not("#nav-menu").toggleClass("nav-closed")}))}),a("#nav-menu.nav-normal-menu li").each(function(){a(this).on("mouseover",function(){a(this).find("ul.nav-closed").each(function(){a(this).removeClass("nav-closed")})})})}function e(c){var d=c.find(".login"),e=c.find(".account").hide(),f=e.find("li.real-account-li").hide(),g=c.find("span.time"),h=c.find(".login button"),i=c.find(".account .logout"),j=c.find(".account span.login-id"),k=c.find(".account span.balance").fadeOut(),l="";require(["websockets/binary_websockets"],function(b){function c(a){if(!l)return void b.send({payout_currencies:1}).then(function(b){l=b.payout_currencies[0],setTimeout(function(){c(a)},0)})["catch"](function(a){});var d="0";d=a.authorize?a.authorize.balance:a.balance.balance,k.text(l+" "+formatPrice(d)).fadeIn()}b.events.on("balance",c),b.events.on("logout",function(){a(".webtrader-dialog[data-authorized=true]").dialog("close").dialog("destroy").remove(),i.removeAttr("disabled"),e.fadeOut(),d.fadeIn(),j.fadeOut(),k.fadeOut(),l=""}),b.events.on("login",function(g){a(".webtrader-dialog[data-authorized=true]").dialog("close").dialog("destroy").remove(),d.fadeOut(),e.fadeIn(),c(g),j.text("Account "+g.authorize.loginid).fadeIn();for(var h=local_storage.get("oauth")||[],k=!1,l=0;l<h.length;++l)0===h[l].is_virtual&&(k=!0);k?f.hide():f.show(),a(".account li.info").remove(),h.forEach(function(c){if(c.id!==g.authorize.loginid){var d=a('<a href="#"></a>').html('<span class="ui-icon ui-icon-login"></span>'+c.id),e=a("<li/>").append(d).addClass("info");e.data(c),e.click(function(){var c=a(this).data();a(".account li.info").remove(),b.switch_account(c.id)["catch"](function(b){a.growl.error({message:b.message})})}),e.insertBefore(i.parent())}})}),h.on("click",function(){h.attr("disabled","disabled"),require(["oauth/login"],function(a){h.removeAttr("disabled"),a.init()})}),i.on("click",function(){b.invalidate(),i.attr("disabled","disabled")})}),g.text(b.utc().format("YYYY-MM-DD HH:mm")+" GMT"),setInterval(function(){g.text(b.utc().format("YYYY-MM-DD HH:mm")+" GMT")},15e3)}return{init:function(b){var f=a(c);a("body").prepend(f),e(f),require(["themes/themes"]),d(),b&&b(a("#nav-menu")),is_beta()&&f.find("a.config").closest("li").show()},updateDropdownToggles:d}});