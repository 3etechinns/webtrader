define(["jquery","windows/windows","lodash","common/util"],function(a,b,c){var d=null,e=null;return{init:function(f){f.click(function(){d?d.moveToTop():(d=b.createBlankWindow(a('<div style="padding: 10px;" class="wschange"><div>Web Socket URL</div><input></div>'),{title:"Change Backend Server",width:300,height:160,resizable:!1,collapsable:!1,minimizable:!1,maximizable:!1,modal:!0,ignoreTileAction:!0,"data-authorized":"true",open:function(){var b=local_storage.get("websocket_url"),c=b&&b.url||"wss://ws.binaryws.com/websockets/v3?l=EN";a(".wschange input").val(c)},destroy:function(){d=null},buttons:{Apply:function(){var d=c.trim(a(".wschange input").val());return d.length<=0||0!==d.indexOf("wss://")?void a.growl.error({message:"Incorrect Web socket URL"}):(a(this).dialog("close"),a(this).dialog("destroy"),void(e?e.moveToTop():(e=b.createBlankWindow(a("<p>In order to properly apply this change, a full refresh of page is required. Are you sure you want to proceed?</p>"),{title:"Confirm",width:350,height:160,resizable:!1,collapsable:!1,minimizable:!1,maximizable:!1,modal:!0,ignoreTileAction:!0,"data-authorized":"true",destroy:function(){e=null},buttons:{Ok:function(){a(this).dialog("close"),a(this).dialog("destroy"),local_storage.set("websocket_url",{url:d}),location.reload()},Cancel:function(){a(this).dialog("close"),a(this).dialog("destroy")}}}),e.dialog("open"))))},Cancel:function(){a(this).dialog("close"),a(this).dialog("destroy")}}}),d.dialog("open"))})}}});