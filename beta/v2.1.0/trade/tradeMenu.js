define(["jquery","lodash","websockets/binary_websockets","navigation/menu","jquery-growl"],function(a,b,c,d){function e(){c.send({active_symbols:"brief"}).then(function(e){var f=_(e.active_symbols).groupBy("market").map(function(a){var b=_.head(a),c={name:b.market,display_name:b.market_display_name};return c.submarkets=_(a).groupBy("submarket").map(function(a){var b=_.head(a),c={name:b.submarket,display_name:b.submarket_display_name};return c.instruments=_.map(a,function(a){return{symbol:a.symbol,display_name:a.display_name,is_disabled:a.is_trading_suspended||!a.exchange_is_open,pip:a.pip}}),c.is_disabled=_.every(c.instruments,"is_disabled"),c}).value(),c.is_disabled=_.every(c.submarkets,"is_disabled"),c}).value();f=d.sortMenu(f);var h=a("#nav-menu").find(".trade");h.find("> ul").remove();var i=a("<ul>").appendTo(h);d.refreshMenu(i,f,function(a){var d=a.data(),e=local_storage.get("windows")||{};e.windows=e.windows||[],e.windows.push(b.extend(d,{isTrade:!0})),local_storage.set("windows",e),c.send({contracts_for:d.symbol}).then(function(a){require(["trade/tradeDialog"],function(b){b.init(d,a.contracts_for)})})["catch"](g)})})["catch"](g)}function f(){require(["trade/tradeDialog"]),e(),require(["websockets/binary_websockets"],function(a){a.events.on("login",e),a.events.on("logout",e)});a("#nav-menu").find(".trade").on("mouseleave",e)}var g=function(b){a.growl.error({message:b.message})};return{init:f}});