define(["jquery","windows/windows","websockets/binary_websockets","datatables","jquery-growl"],function(a,b,c){function d(c){loadCSS("assetindex/assetIndex.css"),c.click(function(){i||(i=b.createBlankWindow(a("<div/>"),{title:"Asset Index",width:750}),a.get("assetindex/assetIndex.html",g)),i.dialog("open")})}function e(a){var b=a.trading_times&&a.trading_times.markets||[],c={};return b.forEach(function(a){var b=c[a.name]={};a.submarkets.forEach(function(a){b[a.name]=a.symbols.map(function(a){return a.name})})}),c}function f(){var d=[],f={},g=function(a,b){var c=f[a][b],e=d.filter(function(a){return c.indexOf(a[1])>-1}).map(function(a){var b=a[2].map(function(a){return a[2]+"-"+a[3]});return b.unshift(a[1]),b});h.api().rows().remove(),h.api().rows.add(e),h.api().draw()},j=a("#"+h.attr("id")+"_processing").show();Promise.all([c.cached.send({trading_times:(new Date).toISOString().slice(0,10)}),c.cached.send({asset_index:1})]).then(function(c){try{d=c[1].asset_index,f=e(c[0]);var h=(i.parent().find(".ui-dialog-titlebar").addClass("with-contents"),i.parent().find(".ui-dialog-titlebar-buttonpane")),k=b.makeSelectmenu(a("<select />").insertBefore(h),{list:Object.keys(f),inx:0,changed:function(a){var b=Object.keys(f[a]);l.update_list(b),g(k.val(),l.val())},width:"120px"});k.selectmenu("widget").addClass("asset-index-selectmenu");var l=b.makeSelectmenu(a("<select />").insertBefore(h),{list:Object.keys(f[k.val()]),inx:0,changed:function(){g(k.val(),l.val())},width:"135px"});l.selectmenu("widget").addClass("asset-index-selectmenu"),g(k.val(),l.val()),j.hide()}catch(m){}})["catch"](function(b){a.growl.error({message:b.message})})}function g(b){b=a(b),h=b.filter("table"),b.appendTo(i),h=h.dataTable({data:[],columnDefs:[{className:"dt-body-center dt-header-center",targets:[0,1,2,3,4]},{defaultContent:"-",targets:[0,1,2,3,4]}],paging:!1,ordering:!1,searching:!0,processing:!0}),h.parent().addClass("hide-search-input"),h.api().column(0).every(function(){var b=this;a("input",this.header()).on("keyup change",function(){b.search()!==this.value&&b.search(this.value).draw()})}),f()}var h=null,i=null;return{init:d}});