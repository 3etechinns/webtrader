define(["jquery","windows/windows","websockets/binary_websockets","datatables","jquery-growl"],function(a,b,c){function d(b){require(["css!statement/statement.css"]),require(["text!statement/statement.html"]),b.click(function(){f?f.moveToTop():c.cached.authorize().then(e)["catch"](function(b){a.growl.error({message:b.message})})})}function e(){f=b.createBlankWindow(a("<div/>"),{title:"Statement",width:900,destroy:function(){g&&g.DataTable().destroy(!0),f=null},"data-authorized":"true"}),require(["text!statement/statement.html"],function(b){b=a(b),b.appendTo(f),g=b,g=g.dataTable({data:[],columnDefs:[{targets:4,createdCell:function(b,c){var d=0>c?"red":c>0?"green":"bold";d&&a(b).addClass(d)}}],paging:!1,ordering:!1,searching:!0,processing:!0}),g.parent().addClass("hide-search-input"),g.api().columns().every(function(){var b=this;a("input",this.header()).on("keyup change",function(){b.search()!==this.value&&b.search(this.value).draw()})});var d=!1,e=!1,h=function(b){var f=a("#"+g.attr("id")+"_processing").css("top","200px").show();d=!0;var h={statement:1,description:1};if("string"==typeof b){h.date_from=yyyy_mm_dd_to_epoch(b,{utc:!0});var i=Date.UTC(1970,0,1,23,59,59)/1e3;h.date_to=h.date_from+i,g.api().rows().remove(),e=!0}else h.limit=50,e&&(g.api().rows().remove(),e=!1),h.offset=g.api().column(0).data().length;var j=function(a){var b=a.statement&&a.statement.transactions||[],c=b.map(function(a){var b=1*a.amount,c=b>0?"up":0>b?"down":"equal",d='<img class="arrow" src="images/'+c+'-arrow.svg"/>';return[epoch_to_string(a.transaction_time,{utc:!0}),a.transaction_id,capitalizeFirstLetter(a.action_type),d+a.longcode,(1*a.amount).toFixed(2),"<b>"+formatPrice(a.balance_after)+"</b>"]});g.api().rows.add(c),g.api().draw(),d=!1,f.hide()};c.send(h).then(j)["catch"](function(b){j({}),a.growl.error({message:b.message})})};f.addDateToHeader({title:"Jump to: ",date:null,changed:h,cleared:h}),f.dialog("open"),h(),f.scroll(function(){var a=f.scrollTop(),b=f.innerHeight(),c=f[0].scrollHeight,g=(a+b)/c;g>.75&&!d&&!e&&h()})})}var f=null,g=null;return{init:d}});