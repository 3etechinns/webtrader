{"version":3,"sources":["../../../../src/cashier/currency.es6"],"names":["require","check_promise","check_currency_async","Promise","resolve","reject","$html","win","createBlankWindow","dialogClass","width","height","resizable","collapsable","minimizable","maximizable","modal","ignoreTileAction","close","dialog","remove","destroy","win_view","unbind","state","disabled","value","array","continue","send","set_account_currency","then","local_storage","set","oauth","get","currency","switch_account","id","balance","subscribe","catch","err","console","error","cancel","message","i18n","cached","payout_currencies","data","forEach","config","currency_obj","type","push","categories","uniqBy","map","e","formatters","format_category","category","log","capitalize","bind","check_currency","up"],"mappings":"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","file":"currency.js","sourcesContent":["import $ from 'jquery';\nimport liveapi from 'websockets/binary_websockets';\nimport windows from 'windows/windows';\nimport rv from 'common/rivetsExtra';\nimport html from 'text!cashier/currency.html';\nimport _ from 'lodash';\n\nrequire(['common/util']);\n\nlet check_promise = null;\nconst check_currency_async = () => new Promise((resolve, reject) => {\n  var $html = $(html);\n  var win = windows.createBlankWindow($html, {\n    dialogClass: \"dialog-confirm\",\n    width: 500,\n    height: 210,\n    resizable: false,\n    collapsable: false,\n    minimizable: false,\n    maximizable: false,\n    modal: true,\n    ignoreTileAction: true,\n    close: () => {\n      win.dialog('destroy');\n      win.remove();\n      win = null;\n    },\n    destroy: () => {\n      win_view && win_view.unbind();\n      win_view = null;\n    }\n  });\n\n  var state = {\n    disabled: true,\n    value: 'Select a value',\n    array: ['Select a value'],\n    continue: () => {\n      state.disabled = true;\n      liveapi.send({ set_account_currency: state.value })\n        .then(resolve, reject)\n        .then(() => {\n          local_storage.set(\"currency\", state.value);\n          const oauth = local_storage.get('oauth');\n          oauth[0].currency = state.value;\n          local_storage.set(\"oauth\", oauth);\n          liveapi.switch_account(oauth[0].id); // To emit login.\n          //For updating balance in navigation\n          liveapi.send({ balance: 1, subscribe: 1 })\n            .catch(function (err) { console.error(err); });\n          win.dialog('close');\n        });\n    },\n    cancel: () => {\n      win.dialog('close');\n      reject({ message: 'Please set currency.'.i18n() });\n    }\n  };\n\n  liveapi.cached.send({ payout_currencies: 1 }).then((data) => {\n    state.disabled = false;\n    state.array = [];\n    data.payout_currencies.forEach((currency) => {\n      const config = local_storage.get(\"currencies_config\") || {};\n      const currency_obj = {\n        value: currency,\n        type: config[currency] ? config[currency].type : ''\n      };\n      state.array.push(currency_obj);\n    });\n    state.categories = _.uniqBy(state.array, \"type\").map((e) => e.type);\n    state.value = data.payout_currencies[0];\n  }).catch(() => reject({ message: 'Please try again after few minutes.'.i18n() }));\n\n  rv.formatters.format_category = (category) => {\n    console.log(category);\n    return _.capitalize(category) + \" Currencies\"\n  };\n\n  var win_view = rv.bind($html[0], state);\n  win.dialog('open');\n});\n\nexport const check_currency = () => {\n  if (check_promise) { return check_promise; }\n  check_promise = check_currency_async().then(() => check_promise = null).catch(up => {\n    check_promise = null;\n    throw up;\n  });\n  return check_promise;\n}\n\nexport default {\n  check_currency\n}\n"]}