{"version":3,"sources":["../../../../src/cashier/deposit.es6"],"names":[],"mappings":"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","file":"deposit.js","sourcesContent":["/*\n * Created by amin on June 26, 2016.\n */\n\ndefine(['jquery', 'websockets/binary_websockets', 'windows/windows', 'common/rivetsExtra', 'lodash', 'moment'], function($, liveapi, windows, rv, _, moment) {\n    require(['text!cashier/deposit.html']);\n    require(['css!cashier/deposit.css']);\n    var deposit_win = null;\n    var deposit_win_view = null; // rivets view\n\n    var error_handler = function(err) {\n      console.error(err);\n      $.growl.error({ message: err.message });\n    };\n\n    function init(li) {\n      li.click(() => {\n          if(!deposit_win)\n            require(['text!cashier/deposit.html'], init_deposit_win);\n          else\n            deposit_win.moveToTop();\n      });\n    }\n\n    function init_deposit_win(root) {\n      root = $(root);\n      deposit_win = windows.createBlankWindow(root, {\n          title: 'Deposit funds',\n          resizable: true,\n          collapsable: false,\n          minimizable: true,\n          maximizable: true,\n          width: 700,\n          height: 600,\n          'data-authorized': true,\n          close: function () {\n            deposit_win.dialog('destroy');\n            deposit_win.trigger('dialogclose'); // TODO: figure out why event is not fired.\n            deposit_win.remove();\n            deposit_win = null;\n          },\n          open: function () { },\n          destroy: function() {\n            deposit_win_view && deposit_win_view.unbind();\n            deposit_win_view = null;\n          }\n      });\n\n      init_state(root);\n      deposit_win.dialog('open');\n\n      /* update dialog position, this way when dialog is resized it will not move*/\n      var offset = deposit_win.dialog('widget').offset();\n      offset.top = 110;\n      deposit_win.dialog(\"option\", \"position\", { my: offset.left, at: offset.top });\n      deposit_win.dialog('widget').css({\n          left: offset.left + 'px',\n          top: offset.top + 'px'\n      });\n      deposit_win.fixFooterPosition();\n      deposit_win.track({\n        module_id: 'deposit',\n        is_unique: true\n      });\n    }\n\n    function init_state(root) {\n      var app_id = liveapi.app_id;\n      var state = {\n        route: { value: 'standard-methods'},\n        empty_fields: {\n          validate: false,\n          clear: _.debounce(function() {\n            state.empty_fields.validate = false;\n          }, 4000),\n          show: function() {\n            state.empty_fields.validate = true;\n            state.empty_fields.clear();\n          }\n        },\n        user: {\n          email: local_storage.get('authorize').email,\n          cashier_url:'',\n          residence: '',\n          residence_name: ''\n        },\n        standard_methods: {\n          iframe_visible: false,\n        },\n        payment_agents: {\n          list: [],\n          current: {}\n        }\n      };\n\n      state.route.update = route => { state.route.value = route; };\n\n      state.standard_methods.iframe_loaded = function() {\n        if(state.user.cashier_url)\n          state.standard_methods.iframe_visible = true;\n      }\n\n      state.payment_agents.get_commission_text = function(agent) {\n        if(agent.deposit_commission === agent.withdrawal_commission) {\n            return agent.deposit_commission + '% ' + 'commission'.i18n();\n        }\n        return agent.deposit_commission + '% ' + 'deposits'.i18n() + ' / ' +\n               agent.withdrawal_commission + '% ' + 'withdrawals'.i18n();\n      }\n      state.payment_agents.onclick = function(agent, e){\n        console.warn(e.target);\n        var elem = $(e.target).next();\n        var cur_elem = state.payment_agents.elem;\n        cur_elem && cur_elem.css('max-height', '0');\n        state.payment_agents.current.is_active = false;\n        if(state.payment_agents.current === agent) {\n          state.payment_agents.current = {};\n        }\n        else {\n          state.payment_agents.current = agent;\n          state.payment_agents.elem = elem;\n          elem.css('max-height', elem[0].scrollHeight + 'px');\n          agent.is_active = true;\n        }\n      }\n\n      deposit_win_view = rv.bind(root[0], state);\n\n      /* get the cashier_url */\n      liveapi.send({\n        cashier: 'deposit'\n      }).then(function(data) {\n          state.user.cashier_url = data.cashier;\n      }).catch(error_handler);\n\n      /* get the residence field and its states */\n      var residence_promise = liveapi.send({get_settings: 1})\n             .then(function(data){\n               state.user.residence = data.get_settings.country_code;\n               state.user.residence_name = data.get_settings.country;\n             })\n             .catch(error_handler);\n\n      /* get payment agents list */\n      residence_promise.then(function() {\n        if(!state.user.residence)\n          return { paymentagent_list: { list: [] } };\n        return liveapi.cached.send({paymentagent_list: state.user.residence });\n      }).then(function(data){\n        var list = data.paymentagent_list.list.map(function(agent){\n          agent.commission_text = state.payment_agents.get_commission_text(agent);\n          agent.supported_banks = agent.supported_banks.toLowerCase().split(',');\n          return agent;\n        })\n        state.payment_agents.list = list;\n      }).catch(error_handler);\n    }\n\n    return {\n      init: init\n    }\n});\n"]}