define(["indicator_base","highstock"],function(a){function b(b,c){var d=c,f=c-1,g=c-2,h=c-3,i=c-4,j=a.extractPriceForAppliedTO(a.OPEN,b,i),k=a.extractPriceForAppliedTO(a.CLOSE,b,i),l=a.extractPriceForAppliedTO(a.LOW,b,i),m=a.extractPriceForAppliedTO(a.HIGH,b,i),n=a.extractPriceForAppliedTO(a.OPEN,b,h),o=a.extractPriceForAppliedTO(a.CLOSE,b,h),p=a.extractPriceForAppliedTO(a.LOW,b,h),q=a.extractPriceForAppliedTO(a.HIGH,b,h),r=a.extractPriceForAppliedTO(a.OPEN,b,g),s=a.extractPriceForAppliedTO(a.CLOSE,b,g),t=a.extractPriceForAppliedTO(a.LOW,b,g),u=a.extractPriceForAppliedTO(a.HIGH,b,g),v=a.extractPriceForAppliedTO(a.OPEN,b,f),w=a.extractPriceForAppliedTO(a.CLOSE,b,f),x=a.extractPriceForAppliedTO(a.LOW,b,f),y=a.extractPriceForAppliedTO(a.HIGH,b,f),z=a.extractPriceForAppliedTO(a.OPEN,b,d),A=a.extractPriceForAppliedTO(a.CLOSE,b,d),B=(a.extractPriceForAppliedTO(a.LOW,b,d),a.extractPriceForAppliedTO(a.HIGH,b,d),k>j),C=j>k,D=o>n,E=n>o,F=s>r,G=r>s,H=w>v,I=v>w,J=A>z,K=z>A,L=B&&Math.abs(k-j)>e&&E&&p>l&&m>q&&G&&t>l&&m>u&&I&&x>l&&m>y&&J&&z>w&&A>k,M=C&&Math.abs(k-j)>e&&D&&p>l&&m>q&&F&&t>l&&m>u&&H&&x>l&&m>y&&K&&w>z&&k>A;return{isBullishContinuation:L,isBearishContinuation:M}}var c={},d={},e=0;return{init:function(){!function(a,f,g){function h(a,e){{var f=this;f.chart}for(var h in d)if(d[h]&&d[h].options&&d[h].options.data&&d[h].options.data.length>0&&c[h].parentSeriesID==f.options.id){var i=f.options.data,j=g.findIndexInDataForTime(i,a);if(j>=1){var k=b(i,j),l=null;k.isBullishContinuation?l={x:i[j].x||i[j][0],title:'<span style="color : blue">RFTM</span>',text:"Rising Three Methods : Bull"}:k.isBearishContinuation&&(l={x:i[j].x||i[j][0],title:'<span style="color : red">RFTM</span>',text:"Falling Three Methods : Bear"});for(var m=-1,n=d[h].data.length-1;n>=0;n--)if((d[h].data[n].x||d[h].data[n][0])==(i[j].x||i[j][0])){m=n;break}l?(e&&m>=0&&d[h].data[m].remove(),d[h].addPoint(l)):m>=0&&d[h].data[m].remove()}}}a&&!a.Series.prototype.addCDLRISEFALL3METHODS&&(a.Series.prototype.addCDLRISEFALL3METHODS=function(a){var h=this.options.id;a=f.extend({parentSeriesID:h},a);var i="_"+(new Date).getTime(),j=this.options.data||[];if(j&&j.length>0){e=g.getCandleMediumHeight(j);for(var k=[],l=4;l<j.length;l++){var m=b(j,l);m.isBullishContinuation&&k.push({x:j[l].x||j[l][0],title:'<span style="color : blue">RFTM</span>',text:"Rising Three Methods : Bull"}),m.isBearishContinuation&&k.push({x:j[l].x||j[l][0],title:'<span style="color : red">RFTM</span>',text:"Falling Three Methods : Bear"})}var n=this.chart;c[i]=a;d[i]=n.addSeries({id:i,name:"CDLRISEFALL3METHODS",data:k,type:"flags",onSeries:h,shape:"flag",turboThreshold:0},!1,!1),f(d[i]).data({isIndicator:!0,indicatorID:"cdlrisefall3methods",parentSeriesID:a.parentSeriesID}),n.redraw()}return i},a.Series.prototype.removeCDLRISEFALL3METHODS=function(a){var b=this.chart;c[a]=null,b.get(a).remove(!1),d[a]=null,b.redraw()},a.Series.prototype.preRemovalCheckCDLRISEFALL3METHODS=function(a){return{isMainIndicator:!0,isValidUniqueID:null!=c[a]}},a.wrap(a.Series.prototype,"addPoint",function(a,b,d,e,f){a.call(this,b,d,e,f),g.checkCurrentSeriesHasIndicator(c,this.options.id)&&h.call(this,b[0])}),a.wrap(a.Point.prototype,"update",function(a,b,d,e){a.call(this,b,d,e),g.checkCurrentSeriesHasIndicator(c,this.series.options.id)&&h.call(this.series,this.x,!0)}))}(Highcharts,jQuery,a)}}});