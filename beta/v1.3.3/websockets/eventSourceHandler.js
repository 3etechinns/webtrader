define(["currentPriceIndicator","lokijs","reconnecting-websocket","websockets/ohlc_handler","websockets/tick_handler","websockets/symbol_handler","websockets/connection_check","common/util","jquery-timer"],function(a,b,c,d,e,f,g){var h=new b,i=h.addCollection("bars_table"),j={},k=!1,l=new c("wss://www.binary.com/websockets/v2");l.debug=!1,l.timeoutInterval=5400,l.onopen=function(){k=!0,$(document).trigger("websocketsConnectionReady")},l.onerror=function(a){};return g.init(l,j),l.onmessage=function(a){var b=JSON.parse(a.data);switch(break;case"trading_times":f.process(b);break;case"candles":for(var c in b.candles){var h=b.candles[c],k=parseFloat(h.open),l=parseFloat(h.high),m=parseFloat(h.low),n=parseFloat(h.close),o=1e3*parseInt(h.epoch),p=i.chain().find({time:o}).find({instrumentCdAndTp:b.echo_req.instrumentCdAndTp}).limit(1).data();p&&p.length>0?(p=p[0],p.open=k,p.high=l,p.low=m,p.close=n,i.update(p)):i.insert({instrumentCdAndTp:b.echo_req.instrumentCdAndTp,time:o,open:k,high:l,low:m,close:n})}d.barsLoaded(b.echo_req.instrumentCdAndTp,j,i,b.echo_req.isTimer,null);break;case"history":for(var c in b.history.times){var o=1e3*parseInt(b.history.times[c]),q=parseFloat(b.history.prices[c]),p=i.chain().find({time:o}).find({instrumentCdAndTp:b.echo_req.instrumentCdAndTp}).limit(1).data();p&&p.length>0?(p=p[0],p.open=q,p.high=q,p.low=q,p.close=q,i.update(p)):i.insert({instrumentCdAndTp:b.echo_req.instrumentCdAndTp,time:o,open:q,high:q,low:q,close:q})}d.barsLoaded(b.echo_req.instrumentCdAndTp,j,i,!1,null);break;case"tick":if(else if(b.echo_req.instrumentCdAndTp){var r=j[b.echo_req.instrumentCdAndTp];if(r){$(document).trigger("feedTypeNotification",[b.echo_req.instrumentCdAndTp,"realtime-feed"]);var q=parseFloat(b.tick.quote),o=1e3*parseInt(b.tick.epoch);e.tickReceived(r,b.echo_req.instrumentCdAndTp,o,q,i)}}break;case"error":if(j)for(var e in j[d].chartIDs){var f=j[d].chartIDs[e];if(f.containerIDWithHash==a){j[d].chartIDs.splice(e,1);break}}$.isEmptyObject(j[d].chartIDs)&&(l.send(JSON.stringify({forget:j[d].tickStreamingID})),$(document).stopTime(j[d].timerHandler),delete j[d])}}}});