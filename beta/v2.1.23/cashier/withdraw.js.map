{"version":3,"sources":["../../../../src/cashier/withdraw.es6"],"names":["require","win","win_view","error_handler","console","error","err","growl","message","Withdraw","init","li","click","cached","authorize","then","data","currency","check_currency","_init_win","catch","moveToTop","root","i18n","createBlankWindow","title","resizable","collapsable","minimizable","maximizable","width","height","close","dialog","trigger","remove","open","destroy","unbind","_init_state","offset","top","my","left","at","css","fixFooterPosition","track","module_id","is_unique","state","clear","debounce","obj","prop","route","value","empty_fields","validate","token_length","show","invalid_length","invalid_text","length","verify","token","text","test","agent","instructions","menu","choice","code","disabled","transfer","account","amount","loginid","local_storage","get","standard","url","iframe_visible","name","agents","commission","residence","checkAmount","e","scope","login_details","Cookies","loginids","reduce","a","b","id","routes","update","r","email","type","send","verify_email","notice","back","unlock","cashier","verification_code","startsWith","Error","iframe_loaded","onchanged","find","paymentagent_loginid","withdrawal_commission","amount_with_commission","with_commission","toFixed","confirm_transfer","request","paymentagent_withdraw","description","submit","req","transfer_between_accounts","account_from","account_to","get_settings","country_code","paymentagent_list","list","payout_currencies","bind"],"mappings":"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","file":"withdraw.js","sourcesContent":["/*\n * Created by amin on July 16, 2016.\n */\n\nimport $ from 'jquery';\nimport liveapi from 'websockets/binary_websockets';\nimport windows from 'windows/windows';\nimport rv from 'common/rivetsExtra';\nimport currencyDialog from 'cashier/currency';\nimport _ from 'lodash';\nimport moment from 'moment';\n\nrequire(['text!cashier/withdraw.html']);\nrequire(['css!cashier/withdraw.css']);\n\nlet win = null;\nlet win_view = null;\n\nlet error_handler = err => {\n  console.error(err);\n  $.growl.error({ message: err.message });\n};\n\nclass Withdraw {\n  init = li => {\n    li.click(() => {\n        if(!win) {\n          liveapi.cached.authorize().then(data => {\n            if(!data.authorize.currency) // if currency is not set ask for currency\n              return currencyDialog.check_currency();\n            return true; // OK\n          })\n          .then(() => require(['text!cashier/withdraw.html'], this._init_win))\n          .catch(error_handler);\n        }\n        else\n          win.moveToTop();\n    });\n  }\n\n  _init_win = root => {\n    root = $(root).i18n();\n    win = windows.createBlankWindow(root, {\n        title: 'Withdraw funds',\n        resizable: true,\n        collapsable: false,\n        minimizable: true,\n        maximizable: true,\n        width: 700,\n        height: 400,\n        'data-authorized': true,\n        close: () => {\n          win.dialog('destroy');\n          win.trigger('dialogclose'); // TODO: figure out why event is not fired.\n          win.remove();\n          win = null;\n        },\n        open: () => { },\n        destroy: () => {\n          win_view && win_view.unbind();\n          win_view = null;\n        }\n    });\n\n    this._init_state(root);\n    win.dialog('open');\n\n    /* update dialog position, this way when dialog is resized it will not move*/\n    var offset = win.dialog('widget').offset();\n    offset.top = 110;\n    win.dialog(\"option\", \"position\", { my: offset.left, at: offset.top });\n    win.dialog('widget').css({\n        left: offset.left + 'px',\n        top: offset.top + 'px'\n    });\n    win.fixFooterPosition();\n    win.track({\n      module_id: 'withdraw',\n      is_unique: true\n    });\n  };\n\n  _init_state = root => {\n    var state = {\n      clear: _.debounce((obj,prop) => {obj[prop] = false}, 4000),\n      route: { value: 'menu'},\n      empty_fields: {\n        validate: false,\n        token_length:false,\n        show: () => {\n          state.empty_fields.validate = true;\n          state.clear(state.empty_fields, 'validate');\n        }\n      },\n      validate: {\n        invalid_length: false,\n        invalid_text: false,\n        length: () => {\n          if(state.verify.token.length != 48){\n            state.validate.invalid_length = true;\n            state.clear(state.validate,'invalid_length');\n            return false;\n          }\n          return true;\n        },\n        text : () =>{\n          if(/[^1-9a-zA-Z'\\- ,.]/g.test(state.agent.instructions)){\n            state.validate.invalid_text = true;\n            state.clear(state.validate, \"invalid_text\");\n            return false;\n          }\n          return true;\n        }\n      },\n      menu: {\n        choice: ''\n      },\n      verify: {\n        token: '',\n        code: '',\n        disabled: false,\n      },\n      transfer: {\n        disabled: false,\n        account: '',\n        amount: '',\n        loginid: local_storage.get('authorize').loginid,\n      },\n      standard: {\n        url: '',\n        iframe_visible: false\n      },\n      agent: {\n        disabled: false,\n        loginid: '',\n        name: '',\n        agents: [],\n        commission: '',\n        amount: '',\n        currency: local_storage.get('authorize').currency,\n        residence: '',\n        instructions: '',\n        checkAmount: (e,scope) => {\n          const amount = scope.agent.amount;\n          if(amount == ''){\n            return;\n          }\n          if(amount > 2000) {\n            scope.agent.amount = 2000;\n          } \n          if(amount < 0) {\n            scope.agent.amount = '';\n          }\n        }\n      },\n      login_details: Cookies.loginids().reduce(function(a,b){if(a.id == local_storage.get(\"authorize\").loginid)return a;else return b})\n    };\n    let {route, menu, verify, empty_fields, standard, agent, transfer, validate} = state;\n\n    let routes = { menu : 400, verify: 400, transfer: 400, 'transfer-done': 300, standard: 400, agent: 550, 'agent-confirm': 400, 'agent-done': 300 };\n    route.update = r => {\n      route.value = r;\n      win.dialog('option', 'height', routes[r]);\n    };\n\n    menu.click = choice => { /* choice is 'transfer', 'agent' or 'standard' */\n      menu.choice = choice;\n      route.update(choice !== 'transfer' ? 'verify' : 'transfer');\n      if(choice === 'transfer')\n        return;\n      const email = local_storage.get('authorize').email;\n      const type = choice === 'agent' ? 'paymentagent_withdraw' : 'payment_withdraw';\n      liveapi.send({\n        verify_email: email,\n        type: type\n      })\n      .then(() => $.growl.notice({ message: 'Verification code sent to '.i18n() + email }))\n      .catch(err => {\n        error_handler(err);\n        route.update('menu');\n      });\n    };\n\n    verify.back = () => {\n      verify.token = verify.code = '';\n      route.update('menu');\n    };\n\n    verify.unlock = () => {\n      if(!verify.token) {\n        empty_fields.show();\n        return;\n      }\n\n      if(!validate.length()){\n        return;\n      }\n\n      if(menu.choice === 'standard') {\n        verify.disabled = true;\n        liveapi.send({\n          cashier: 'withdraw',\n          verification_code: verify.token\n        })\n        .then(data => {\n          if(data.cashier.startsWith('ASK_')) { /* error code */\n            throw new Error(data.cashier);\n          }\n          standard.url = data.cashier;\n          verify.disabled = false;\n          route.update('standard');\n          verify.code = verify.token;\n          verify.token = '';\n        })\n        .catch(err => {\n          verify.disabled = false;\n          error_handler(err);\n        });\n      }\n      else if(menu.choice == 'agent') {\n        verify.code = verify.token;\n        verify.token = '';\n        route.update('agent');\n      }\n    };\n\n    standard.iframe_loaded = () => {\n      if(standard.url)\n        standard.iframe_visible = true;\n    };\n\n    agent.onchanged = () => {\n      if(agent.loginid) {\n        let {withdrawal_commission, name} = agent.agents.find(a => a.paymentagent_loginid == agent.loginid);\n        agent.commission = withdrawal_commission;\n        agent.name = name;\n      }\n      else {\n        agent.commission = '';\n        agent.name = '';\n      }\n    }\n\n    agent.amount_with_commission = () => {\n        var with_commission = (agent.amount || 0)*(100 - agent.commission)/100;\n        return with_commission.toFixed(2);\n    }\n\n    agent.click = () => {\n      if(!agent.loginid) {\n        $.growl.error({message: 'Please select a payment agent'.i18n()});\n        return;\n      }\n      if(!(agent.amount >= 10 && agent.amount <= 2000)) {\n        $.growl.error({message: 'Amount Min: 10 Max: 2000'.i18n()});\n        return;\n      }\n      if(agent.instructions && !validate.text()) {\n        return;\n      }\n\n      route.update('agent-confirm');\n    }\n\n    agent.confirm_transfer = () => {\n      var request = {\n        paymentagent_withdraw: 1,\n        paymentagent_loginid: agent.loginid,\n        currency: agent.currency,\n        amount: agent.amount*1,\n        description: agent.instructions,\n        verification_code: verify.code\n      };\n      agent.disabled = true;\n      liveapi.send(request)\n             .then(data => {\n               route.update('agent-done')\n               agent.disabled = false;\n             })\n             .catch(err => {\n                agent.disabled = false;\n                route.update('menu') // because tokens are one time use.\n                error_handler(err);\n             });\n    }\n\n    transfer.submit = () => {\n      if(transfer.account === '' || transfer.amount === '') {\n        empty_fields.show();\n        return;\n      }\n      var req = {\n        transfer_between_accounts: 1,\n        account_from: transfer.loginid,\n        account_to: transfer.account,\n        currency: agent.currency,\n        amount: transfer.amount\n      };\n      transfer.disabled = true;\n      liveapi.send(req)\n        .then(data => {\n          if(data.transfer_between_accounts === 0) {\n            $.growl.error({message: 'Transfering funds between accounts failed'.i18n() });\n            return;\n          }\n          route.update('transfer-done');\n        })\n        .catch(err => {\n          error_handler(err);\n          transfer.disabled = false;\n        });\n    }\n\n    liveapi.send({get_settings: 1})\n           .then(data => {\n             agent.residence = data.get_settings.country_code;\n             return liveapi.cached.send({paymentagent_list: agent.residence });\n           })\n           .then(data => {\n             agent.agents = data.paymentagent_list.list;\n           })\n           .catch(error_handler);\n\n    liveapi.send({payout_currencies: 1})\n        .then(data => {\n            agent.currency = data.payout_currencies[0];\n        }).catch(err => console.error(err));\n\n    win_view = rv.bind(root[0], state);\n  };\n};\n\nexport default new Withdraw();\n"]}