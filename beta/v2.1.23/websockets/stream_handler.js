define(["exports","jquery","./binary_websockets","../charts/chartingRequestMap","common/util"],function(a,b,c,d){"use strict";function e(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(a,"__esModule",{value:!0}),a.events=void 0;var f=e(b),g=e(c),h=e(d),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},j=h["default"].barsTable,k=function(a,b,c){a.xAxis.forEach(function(a){b||(b=a.getExtremes().min),c||(c=a.getExtremes().max),a.setExtremes(b,c)})};g["default"].events.on("tick",function(a){var b=a.echo_req.ticks_history+a.echo_req.granularity;if(b&&h["default"][b.toUpperCase()]){var c=function(){b=b.toUpperCase();var c=parseFloat(a.tick.quote),d=1e3*parseInt(a.tick.epoch),e=h["default"][b],g=a.echo_req.granularity||0;if(e.id=e.id||a.tick.id,0===g){var i={instrumentCdAndTp:b,time:d,open:c,high:c,low:c,close:c,price:a.tick.quote};j.insert(i);var k=i,l=j.chain().find({instrumentCdAndTp:b}).simplesort("time",!0).limit(2).data();if(l.length>1&&(k=l[1]),m("tick",{tick:i,key:b,preTick:k}),!(e.chartIDs&&e.chartIDs.length>0))return{v:void 0};e.chartIDs.forEach(function(a){var e=f["default"](a.containerIDWithHash).highcharts();if(e){var g=e.get(b);g&&g.addPoint([d,c])}})}}();if("object"===("undefined"==typeof c?"undefined":i(c)))return c.v}}),g["default"].events.on("ohlc",function(a){var b=a.ohlc.symbol+a.ohlc.granularity;if(b&&h["default"][b.toUpperCase()]){var c=function(){b=b.toUpperCase(),f["default"](document).trigger("feedTypeNotification",[b,"realtime-feed"]);var c=parseFloat(a.ohlc.open),d=parseFloat(a.ohlc.high),e=parseFloat(a.ohlc.low),g=parseFloat(a.ohlc.close),i=1e3*parseInt(a.ohlc.open_time),l=h["default"][b];if(l.id=l.id||a.ohlc.id,!(l.chartIDs&&l.chartIDs.length>0))return{v:void 0};var n=f["default"](l.chartIDs[0].containerIDWithHash).data("timePeriod");if(!n)return{v:void 0};var o=j.chain().find({$and:[{instrumentCdAndTp:b},{time:i}]}).simplesort("time",!0).limit(1).data(),p=!1;!o||o.length<=0?(o={instrumentCdAndTp:b,time:i,open:c,high:d,low:e,close:g},j.insert(o),p=!0):(o=o[0],o.open=c,o.high=d,o.low=e,o.close=g,j.update(o));var q=o,r=j.chain().find({instrumentCdAndTp:b}).simplesort("time",!0).limit(2).data();r.length>1&&(q=r[1]),m("ohlc",{ohlc:o,is_new:p,key:b,preOhlc:q}),l.chartIDs.forEach(function(a){var h=f["default"](a.containerIDWithHash).highcharts();if(h){var j=h.get(b);if(j){var l=f["default"](a.containerIDWithHash).data("type"),m=j.data[j.data.length-1];return j.options.data.length!=j.data.length?void k(h,null,o.time):void(l&&isDataTypeClosePriceOnly(l)?p?j.addPoint([i,g],!0,!0,!1):m.update({y:g}):p?j.addPoint([i,c,d,e,g],!0,!0,!1):m.update({open:c,high:d,low:e,close:g}))}}})}();if("object"===("undefined"==typeof c?"undefined":i(c)))return c.v}});var l={},m=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];var e=l[a]||[];e.forEach(function(a){return setTimeout(function(){return a.apply(void 0,c)},0)})},n=a.events={on:function(a,b){return(l[a]=l[a]||[]).push(b),b},off:function(a,b){if(l[a]){var c=l[a].indexOf(b);-1!==c&&l[a].splice(c,1)}}};a["default"]={events:n}});