{"version":3,"sources":["../../../../src/charts/chartWindow.es6"],"names":["_trigger_Resize_Effects","find","width","height","trigger","containerIDWithHash","attr","triggerReflow","options_store","addNewWindow","options","options_copy","extend","title","instrumentName","relativePosition","close","id","container","timePeriod","data","instrumentCode","highcharts","destroy","dialog","remove","cleanBinding","resize","refresh","createBlankWindow","i18n","end","indicators","overlays","update_track","track","module_id","is_unique","on","e","type","chart","get_indicators","overlay","push","displaySymbol","drawChart","bind","table_view","init","show","add_chart_options","totalWindows","length","get_chart_options","dialog_id","cloneDeep","name","set_chart_options","apply_chart_options","chart_window_functions","require","charts","chartOptions","updateOptions","triggerResizeEffects","callerContext","call","changeChartWindowTitle","dialogId"],"mappings":"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","file":"chartWindow.js","sourcesContent":["/**\n * Created by arnab on 2/13/15.\n */\nimport $ from \"jquery\";\nimport windows from \"windows/windows\";\nimport $chartWindowHtml from \"text!charts/chartWindow.html\";\nimport _ from 'lodash';\nimport \"jquery.dialogextend\";\nimport 'common/util';\nimport charts from \"charts/charts\";\nimport chartOptions from \"charts/chartOptions\";\nimport tableView from \"charts/tableView\";\n\nfunction _trigger_Resize_Effects() {\n    $(this).find(\".chartSubContainer\").width($(this).width() - 10);\n    //Because of title taking space, we have to reduce height\n    $(this).find(\".chartSubContainer\").height($(this).height() - 55);\n    $(this).trigger(\"resize-event\");\n    const containerIDWithHash = \"#\" + $(this).find(\".chartSubContainer\").attr(\"id\");\n    charts.triggerReflow(containerIDWithHash);\n}\n\nconst options_store = {};\n\n/**\n * @param options\n * @returns {*}\n */\nexport const addNewWindow = function(options) {\n    const options_copy = options;\n    options = $.extend({\n        title: options.instrumentName,\n        relativePosition: true,\n        close: function() {\n            const id = $(this).attr('id');\n            const container = $(\"#\" + id + \"_chart\");\n            const timePeriod = container.data(\"timePeriod\");\n            const instrumentCode = container.data('instrumentCode');\n            container.highcharts().destroy();\n            $(this).dialog('destroy').remove(); //completely remove this dialog\n            charts.destroy({\n                containerIDWithHash: \"#\" + id + \"_chart\",\n                timePeriod: timePeriod,\n                instrumentCode: instrumentCode\n            });\n            chartOptions.cleanBinding(id);\n        },\n        resize: _trigger_Resize_Effects,\n        refresh: function() {\n            charts.refresh('#' + id + '_chart');\n        }\n    }, options);\n    const dialog = windows.createBlankWindow($($chartWindowHtml).i18n(), options),\n        id = dialog.attr('id');\n    dialog.find('div.chartSubContainerHeader').attr('id', id + \"_header\").end()\n        .find('div.chartSubContainer').attr('id', id + \"_chart\").end();\n\n\n\n    /* tracking the chart, includion indicators & overlyas */\n    options_store[id] = options_copy;\n    options_store[id].indicators = options_store[id].indicators || [];\n    options_store[id].overlays = options_store[id].overlays || [];\n    const update_track = dialog.track({\n        module_id: 'chartWindow',\n        is_unique: false,\n        data: options_store[id]\n    });\n    dialog.on('chart-type-changed', function(e, type) {\n        options_store[id].type = type;\n        update_track(options_store[id]);\n    });\n    dialog.on('chart-time-period-changed', function(e, timePeriod) {\n        options_store[id].timePeriod = timePeriod;\n        update_track(options_store[id]);\n    });\n    dialog.on('chart-indicators-changed', function(e, chart) {\n        options_store[id].indicators = chart.get_indicators();\n        update_track(options_store[id]);\n    });\n    dialog.on('chart-overlay-add', function(e, overlay) {\n        options_store[id].overlays.push(overlay);\n        update_track(options_store[id]);\n    });\n    dialog.on('chart-overlay-remove', function(e, displaySymbol) {\n        _.remove(options_store[id].overlays, displaySymbol);\n        update_track(options_store[id]);\n    });\n    dialog.on('chart-options-changed', function(e) {\n        update_track(options_store[id]);\n    });\n    dialog.dialog('open');\n    /* initialize chartOptions & table-view once chart is rendered */\n    charts.drawChart(\"#\" + id + \"_chart\", options, options.resize.bind($(dialog)));\n    const table_view = tableView.init(dialog);\n    chartOptions.init(id, options.timePeriod, options.type, table_view.show, options.instrumentName, options.instrumentCode);\n\n    return dialog;\n}\n\n// This is for affiliates. Hope it works. Fingers crossed.\nexport const add_chart_options = function(id, options) {\n    const dialog = $(\"#\" + id);\n    options_store[id] = options;\n    options_store[id].indicators = options_store[id].indicators || [];\n    options_store[id].overlays = options_store[id].overlays || [];\n    dialog.on('chart-type-changed', function(e, type) {\n        options_store[id].type = type;\n    });\n    dialog.on('chart-time-period-changed', function(e, timePeriod) {\n        options_store[id].timePeriod = timePeriod;\n    });\n    dialog.on('chart-indicators-changed', function(e, chart) {\n        options_store[id].indicators = chart.get_indicators();\n    });\n    dialog.on('chart-overlay-add', function(e, overlay) {\n        options_store[id].overlays.push(overlay);\n    });\n    dialog.on('chart-overlay-remove', function(e, displaySymbol) {\n        _.remove(options_store[id].overlays, displaySymbol);\n    });\n}\n\nexport const totalWindows = function() {\n    return $(\"div.webtrader-dialog\").length;\n}\n\n/* id of dialog. WITHOUT '#' prefix or '_chart' suffix */\nexport const get_chart_options = function(dialog_id) {\n    const options = _.cloneDeep(options_store[dialog_id]);\n    if (!options.name) {\n        options.name = '';\n    }\n    return options;\n}\nexport const set_chart_options = function(dialog_id, options) {\n    options.instrumentCode = options_store[dialog_id].instrumentCode;\n    options.instrumentName = options_store[dialog_id].instrumentName;\n    options_store[dialog_id] = options;\n    $('#' + dialog_id).trigger('chart-options-changed');\n}\nexport const apply_chart_options = function(dialog_id, options) {\n    chart_window_functions.set_chart_options(dialog_id, options);\n    require(['charts/charts', 'charts/chartOptions'], function(charts, chartOptions) {\n        chartOptions.updateOptions( /* update the chart options settings */\n            dialog_id, options.type, options.timePeriod, options.indicators.length, options.overlays.length);\n        charts.refresh('#' + dialog_id + '_chart', options.timePeriod, options.type, options.indicators, options.overlays);\n    });\n}\n\n/**\n * @param callerContext - Should be the Jquery object for dialog\n */\nexport const triggerResizeEffects = function(callerContext) {\n    _trigger_Resize_Effects.call(callerContext);\n}\n\nexport const changeChartWindowTitle = function(dialogId, instrumentName, timePeriod) {\n    $('#' + dialogId).dialog('option', 'title', instrumentName + \" (\" + timePeriod + \")\");\n}\nconst chart_window_functions = {\n    addNewWindow,\n    add_chart_options,\n    totalWindows,\n    get_chart_options,\n    set_chart_options,\n    apply_chart_options\n};\n\nexport default chart_window_functions;\n"]}