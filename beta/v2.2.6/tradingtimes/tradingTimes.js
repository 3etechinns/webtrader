define(["exports","jquery","windows/windows","websockets/binary_websockets","navigation/menu","lodash","datatables","jquery-growl"],function(a,b,c,d,e,f){"use strict";function g(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(a,"__esModule",{value:!0}),a.init=void 0;var h=g(b),i=g(c),j=g(d),k=g(e),l=g(f),m=null,n=null,o=null,p=null,q=function(a,b){a=a||[];var c=[],d={};a.filter(function(a){var c=[];return a.submarkets.forEach(function(a){return c=c.concat(a.instruments)}),l["default"].some(c,function(a){var c=b.find(function(b){return b.symbol===a.symbol})||{};return!c.is_trading_suspended&&c.exchange_is_open})}).forEach(function(a){c.push(a.display_name),d[a.display_name]=[],a.submarkets.forEach(function(b){return d[a.display_name].push(b.display_name)})});var e=function(b,c){var d=a.filter(function(a){return a.display_name==b})[0],e=d&&d.submarkets.filter(function(a){return a.display_name==c})[0].instruments,f=(e||[]).map(function(a){return[a.display_name,a.times.open[0],a.times.close[0],a.times.settlement||a.settlement||"-",a.events[0]?a.events[0].descrip+":"+a.events[0].dates:"-"]});return f};return{market_names:c,submarket_names:d,getRowsFor:e}},r=a.init=function(a){require(["css!tradingtimes/tradingTimes.css"]),a.click(function(){n?n.moveToTop():(n=i["default"].createBlankWindow(h["default"]("<div/>"),{title:"Trading Times".i18n(),dialogClass:"tradingTimes",width:700,height:400}),n.track({module_id:"tradingTimes",is_unique:!0,data:null}),n.dialog("open"),require(["text!tradingtimes/tradingTimes.html"],s))})},s=function(a){a=h["default"](a).i18n();var b=a.filter(".trading-times-sub-header");m=a.filter("table"),a.appendTo(n),m=m.dataTable({data:[],columnDefs:[{className:"dt-body-center dt-header-center",targets:[0,1,2,3,4]}],paging:!1,ordering:!1,searching:!0,processing:!0}),m.parent().addClass("hide-search-input"),m.api().columns().every(function(){var a=this;h["default"]("input",this.header()).on("keyup change",function(){a.search()!==this.value&&a.search(this.value).draw()})});var c=null,d=null,e=function(a){var e=h["default"]("#"+m.attr("id")+"_processing").show(),f=function(a,b,c){var d=a.getRowsFor(b,c);m.api().rows().remove(),m.api().rows.add(d),m.api().draw()},g=function(a,g){a=k["default"].extractChartableMarkets(a);var j=q(a,g.active_symbols||[]);null==c?(o=h["default"]("<select />"),o.appendTo(b),c=i["default"].makeSelectmenu(o,{list:j.market_names,inx:0,changed:function(a){d.update_list(j.submarket_names[a]),f(j,c.val(),d.val())}})):o.update_list(j.market_names),null==d?(p=h["default"]("<select />"),p.appendTo(b),d=i["default"].makeSelectmenu(p,{list:j.submarket_names[c.val()],inx:0,changed:function(){return f(j,c.val(),d.val())}})):p.update_list(j.submarket_names[c.val()]),f(j,c.val(),d.val()),e.hide()},l=function(){return Promise.all([j["default"].cached.send({trading_times:a}),j["default"].send({active_symbols:"brief"})]).then(function(a){return g(a[0],a[1])})["catch"](function(a){h["default"].growl.error({message:a.message}),g({},{})})};l(),require(["websockets/binary_websockets"],function(a){a.events.on("login",l),a.events.on("logout",l)})};e((new Date).toISOString().slice(0,10)),n.addDateToHeader({title:"Date: ",date:new Date,changed:e})};a["default"]={init:r}});