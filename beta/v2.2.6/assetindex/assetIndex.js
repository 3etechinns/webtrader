define(["exports","jquery","../windows/windows","../websockets/binary_websockets","../navigation/menu","lodash","datatables","jquery-growl"],function(a,b,c,d,e,f){"use strict";function g(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(a,"__esModule",{value:!0}),a.init=void 0;var h=g(b),i=g(c),j=g(d),k=g(e),l=g(f),m=null,n=null,o=null,p=null,q=[],r={},s=a.init=function(a){a.click(function(){n?n.moveToTop():(n=i["default"].createBlankWindow(h["default"]("<div/>"),{title:"Asset Index".i18n(),dialogClass:"assetIndex",width:700,height:400}),n.track({module_id:"assetIndex",is_unique:!0,data:null}),n.dialog("open"),require(["text!assetindex/assetIndex.html"],v))})},t=function(a,b){a=k["default"].extractChartableMarkets(a);var c={};return a.filter(function(a){var c=[];return a.submarkets.forEach(function(a){return c=c.concat(a.instruments)}),l["default"].some(c,function(a){var c=b.find(function(b){return b.symbol===a.symbol})||{};return!c.is_trading_suspended&&c.exchange_is_open})}).forEach(function(a){var b=c[a.display_name]={};a.submarkets.forEach(function(a){b[a.display_name]=a.instruments.map(function(a){return a.display_name})})}),c},u=function(){var a=function(a,b){var c=r[a][b],d=q.filter(function(a){return c.indexOf(a[1])>-1}).map(function(a){var b=a[2].map(function(a){return a[2]+" - "+a[3]});return b.unshift(a[1]),b});m.api().rows().remove(),m.api().rows.add(d),m.api().draw()},b=h["default"]("#"+m.attr("id")+"_processing").show();Promise.all([j["default"].cached.send({trading_times:(new Date).toISOString().slice(0,10)}),j["default"].cached.send({asset_index:1}),j["default"].send({active_symbols:"brief"})]).then(function(c){try{q=c[1].asset_index.filter(function(a){var b=c[2].active_symbols;return l["default"].find(b,function(b){return l["default"].head(a)===b.symbol})}),r=t(c[0],c[2].active_symbols);var d=(n.parent().find(".ui-dialog-title").addClass("with-content"),n.parent().find(".ui-dialog-titlebar-buttonpane"));o?o.update_list(Object.keys(r)):(o=i["default"].makeSelectmenu(h["default"]("<select />").insertBefore(d),{list:Object.keys(r),inx:0,changed:function(b){var c=Object.keys(r[b]);p.update_list(c),a(o.val(),p.val())},width:"180px"}),o.selectmenu("widget").addClass("asset-index-selectmenu"));var e=local_storage.get("i18n")&&"ar"===local_storage.get("i18n").value;p?p.update_list(Object.keys(r[o.val()])):(p=i["default"].makeSelectmenu(h["default"]("<select />").insertBefore(e?o:d),{list:Object.keys(r[o.val()]),inx:0,changed:function(){a(o.val(),p.val())},width:"200px"}),p.selectmenu("widget").addClass("asset-index-selectmenu")),a(o.val(),p.val()),b.hide()}catch(f){}})["catch"](function(a){h["default"].growl.error({message:a.message})})},v=function(a){a=h["default"](a).i18n(),m=a.filter("table"),a.appendTo(n),m=m.dataTable({data:[],columnDefs:[{className:"dt-body-center dt-header-center",targets:[0,1,2,3,4]},{defaultContent:"-",targets:[0,1,2,3,4]}],paging:!1,ordering:!1,searching:!0,processing:!0}),m.parent().addClass("hide-search-input"),m.api().column(0).every(function(){var a=this;h["default"]("input",this.header()).on("keyup change",function(){a.search()!==this.value&&a.search(this.value).draw()})}),u(),require(["websockets/binary_websockets"],function(a){a.events.on("login",u),a.events.on("logout",u)})};a["default"]={init:s}});