define(["es6-promise","reconnecting-websocket","jquery-timer"],function(a,b){function c(){var a="wss://www.binary.com/websockets/v2",c=new b(a);return c.debug=!1,c.timeInterval=5400,c}a.polyfill();var d={},e=[],f=[],g={},h=new c,i=function(){return h&&1===h.readyState};return h.onopen=function(){for(;f.length>0;)h.send(JSON.stringify(f.shift()));for(;e.length>0;)e.shift()()},h.onmessage=function(a){var b=JSON.parse(a.data);(d[b.msg_type]||[]).forEach(function(a){a(b)});var c=b.echo_req.passthrough&&b.echo_req.passthrough.uid;if(c){var e=g[c];delete g[c],e&&(b.error?e.reject(b.error):e.resolve(b))}},require(["websockets/tick_handler"]),require(["websockets/connection_check"]),{events:{on:function(a,b){(d[a]=d[a]||[]).push(b)}},execute:function(a){i()?setTimeout(a,0):e.push(a)},send:function(a){return a.passthrough=a.passthrough||{},a.passthrough.uid=(1e17*Math.random()).toString(),new Promise(function(b,c){g[a.passthrough.uid]={resolve:b,reject:c},i()?h.send(JSON.stringify(a)):f.push(a)})}}});