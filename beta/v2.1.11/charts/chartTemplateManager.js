"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();define(["jquery","charts/chartWindow","common/rivetsExtra"],function(a,b,c){require(["text!charts/chartTemplateManager.html"]),local_storage.get("templates")||local_storage.set("templates",[]);var d=function(){function d(a,b){var e=this;_classCallCheck(this,d);var f=this.init_state(a,b);require(["text!charts/chartTemplateManager.html"],function(b){a.append(b),e.view=c.bind(a[0],f)})}return _createClass(d,[{key:"init_state",value:function(c,d){var e=(a("#"+d+"_chart").highcharts(),{route:{value:"menu"},menu:{save_changes_disabled:!0},templates:{array:local_storage.get("templates"),save_as_value:"",rename_tmpl:null,rename_value:"",current:null}}),f=e.route,g=e.templates,h=e.menu,i=b.get_chart_options(d);return-1!==_.findIndex(g.array,function(a){return a.name===i.name})&&(g.current=i),f.update=function(a){f.value=a},h.save_as=function(){var a=b.get_chart_options(d)||{};a.name=[a.timePeriod+" "+a.type].concat(a.indicators.map(function(a){return a.name})).concat(a.overlays.map(function(a){return a.displaySymbol})).join(" + "),g.save_as_value=a.name,f.update("save-as")},h.templates=function(){g.array=local_storage.get("templates"),f.update("templates")},h.save_changes=function(){var c=b.get_chart_options(d),e=c.name,f=local_storage.get("templates"),h=_.findIndex(f,function(a){return a.name===e});-1!==h?f[h]=c:f.push(c),local_storage.set("templates",f),g.array=f,g.current=c,a.growl.notice({message:"Template changes saved ".i18n()+"("+c.name+")"})},g.save_as=function(){var c=g.save_as_value,e=b.get_chart_options(d);if(e){e.name=c;var h=local_storage.get("templates");if(h.map(function(a){return a.name}).includes(c))return void a.growl.error({message:"Template name already exists".i18n()});h.push(e),g.current=e,local_storage.set("templates",h),g.array=h,f.update("menu"),b.set_chart_options(d,e)}},g.remove=function(a){var b=local_storage.get("templates");g.array=b.filter(function(b){return b.name!==a.name}),local_storage.set("templates",g.array),g.current&&a.name===g.current.name&&(g.current=null)},g.rename=function(a){g.rename_value=a.name,g.rename_tmpl=a,f.update("rename")},g.do_rename=function(){var c=g.rename_tmpl.name,e=g.rename_value,h=local_storage.get("templates");if(h.map(function(a){return a.name}).includes(e))return void a.growl.error({message:"Template name already exists".i18n()});var i=h.find(function(a){return a.name===c});if(i){i.name=e,local_storage.set("templates",h),g.array=h,f.update("templates");var j=b.get_chart_options(d);j.name==c&&(g.current=j,j.name=e,b.set_chart_options(d,j))}},g.apply=function(a){b.apply_chart_options(d,a),g.current=a},e}},{key:"unbind",value:function(){this.view&&this.view.unbind(),this.view=null}}]),d}();return{init:function(a,b){return new d(a,b)}}});