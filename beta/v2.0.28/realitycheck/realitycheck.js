define(["jquery","windows/windows","websockets/binary_websockets","lodash","common/rivetsExtra","moment","jquery-growl","common/util"],function(a,b,c,d,e,f){var g=null,h=null,i={timeOutInMins:10,timeOutMin:10,timeOutMax:120,loginId:null,durationInMins:null,bought:null,turnOver:null,loginTime:null,sold:null,pnl:null,currentTime:null,open:null,potentialProfit:null,currency:null,continueTrading:function(b,c){return c.timeOutInMins<c.timeOutMin||c.timeOutInMins>c.timeOutMax?void a.growl.error({message:"Please enter a number between "+c.timeOutMin+" to "+c.timeOutMax}):(g.dialog("close"),void k(c.timeOutInMins))},logout:function(){c.invalidate()}},j=function(){return require(["css!realitycheck/realitycheck.css"]),new Promise(function(c){require(["text!realitycheck/realitycheck.html"],function(d){var f=a(d);f.find(".realitycheck_firstscreen").show(),f.find(".realitycheck_secondscreen").hide(),g=b.createBlankWindow(a("<div/>"),{title:"Reality check",width:600,minHeight:90,height:300,resizable:!1,collapsable:!1,minimizable:!1,maximizable:!1,closable:!1,modal:!0,closeOnEscape:!1,ignoreTileAction:!0,"data-authorized":"true",destroy:function(){g=null}}),f.appendTo(g),e.bind(f[0],i),c()})})},k=function(b){h&&clearTimeout(h);var d=60*b*1e3;h=setTimeout(function(){c.send({reality_check:1}).then(function(b){i.durationInMins=f.duration(f.utc().valueOf()-1e3*b.reality_check.start_time).humanize(),i.bought=b.reality_check.buy_count,i.turnOver=b.reality_check.buy_amount,i.loginTime=f.unix(b.reality_check.start_time).format("MMM D, YYYY hh:mm")+" GMT",i.sold=b.reality_check.sell_count,i.pnl=b.reality_check.sell_amount-b.reality_check.buy_amount,i.currentTime=f.utc().format("MMM D, YYYY hh:mm")+" GMT",i.open=b.reality_check.open_contract_count,i.potentialProfit=b.reality_check.potential_profit,i.currency=b.reality_check.currency;var c=a(".realitycheck");c.find(".realitycheck_firstscreen").hide(),c.find(".realitycheck_secondscreen").show(),g.moveToTop()})},d)};return c.events.on("login",function(a){c.cached.authorize().then(function(){i.loginId=a.authorize.loginid,c.send({landing_company_details:a.authorize.landing_company_name}).then(function(a){a&&a.landing_company_details.has_reality_check&&(g&&g.dialog("destroy"),j().then(function(){g.dialog("open")}))})})}),c.events.on("logout",function(){g&&g.dialog("destroy"),g=null,h&&clearTimeout(h),h=null,i.timeOutInMins=10,i.loginId=null,i.durationInMins=null,i.bought=null,i.turnOver=null,i.loginTime=null,i.sold=null,i.pnl=null,i.currentTime=null,i.open=null,i.potentialProfit=null,i.currency=null}),{}});