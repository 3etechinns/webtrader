define(["jquery","datatables"],function(a){function b(c,d,e){a.each(d,function(d,f){f.submarkets||f.instruments?b(c,f.submarkets||f.instruments,e):a(c.row.add([f.display_name]).node()).data({symbol:f.symbol,delay_amount:f.delay_amount}).click(function(){a(".overlay_dialog_add").dialog("close");var b=a(this).data("symbol"),c=a(this).data("delay_amount"),d=a(this).text(),f=a(e).data("timePeriod"),g=a(e).data("type");require(["common/util"],function(){if(isDataTypeClosePriceOnly(g)){var h=convertToTimeperiodObject(f);c<=h.timeInSeconds()/60?require(["charts/chartOptions","charts/charts"],function(f,g){a(e).data("overlayIndicator",!0);var h=e.replace("#","").replace("_chart","");f.isCurrentViewInLogScale(h)&&f.triggerToggleLogScale(h),f.disableEnableLogMenu(h,!1),f.disableEnableCandlestick(h,!1),f.disableEnableOHLC(h,!1),g.overlay(e,b,d,c)}):require(["jquery","jquery-growl"],function(a){a("#timePeriod").addClass("ui-state-error"),a.growl.error({message:d+" is not allowed to overlay on this chart!"})})}else require(["jquery","jquery-growl"],function(a){a("#timePeriod").addClass("ui-state-error"),a.growl.error({message:"Overlaying on "+g+" chart type is not allowed!"})})})})})}function c(c,d,e){c.find("tbody tr").remove();var f=c.find("table").DataTable();f.clear().draw(),b(f,d.getMarketData(),e),f.draw(),a(".overlay_dialog_add").dialog("open")}function d(b){require(["instruments/instruments"],function(d){a.isEmptyObject(d.getMarketData())?require(["jquery","jquery-growl"],function(a){a.growl.error({message:"Market data is not loaded yet!"})}):require(["text!overlay/overlay_add.html"],function(e){e=a(e),e.hide(),e.appendTo("body"),e.find("table").DataTable({paging:!1,scrollY:200,info:!1}),a(".overlay_dialog_add").dialog({autoOpen:!1,resizable:!1,modal:!0,my:"center",at:"center",of:window,buttons:[]}),c(e,d,b)})})}return{openDialog:function(b){return 0==a(".overlay_dialog_add").length?void d(b):void require(["instruments/instruments"],function(d){c(a(".overlay_dialog_add"),d,b)})}}});