define(["jquery","lodash","datatables"],function(a,b){function c(c,e){require(["text!overlay/overlay_remove.html","css!overlay/overlay_remove.css"],function(f){f=a(f),f.hide(),f.appendTo("body"),d=f.find("table").DataTable({paging:!1,scrollY:200,info:!1}),a(".overlay_dialog_remove").dialog({autoOpen:!1,resizable:!1,width:330,modal:!0,my:"center",at:"center",of:window,buttons:[{text:"Remove Selected",click:function(){var c=d.rows(".selected").data().length;if(c>0){var e=a(".overlay_dialog_remove").data("refererChartID");d.rows(".selected").nodes().to$().each(function(){var c=a(this).data("id"),f=a(e).highcharts();if(f&&c){var g=f.get(c);g&&(g.removeCurrentPrice(),g.remove(),b.defer(function(){var c=0;f.series.forEach(function(a){(a.options.isInstrument||a.options.onChartIndicator)&&-1==a.options.id.indexOf("navigator")&&++c}),1==c&&f.series.forEach(function(c){return(c.options.isInstrument||c.options.onChartIndicator)&&-1==c.options.id.indexOf("navigator")?(c.update({compare:void 0}),a(e).data("overlayIndicator",null),require(["charts/chartOptions"],function(a){var b=e.replace("#","").replace("_chart","");a.disableEnableCandlestick(b,!0),a.disableEnableOHLC(b,!0)}),b.defer(function(){f.redraw()}),!1):void 0})}))}d.row(a(this)).remove().draw()})}else a.growl.error({message:"Please select instruments to remove"})}},{text:"Cancel",click:function(){a(".overlay_dialog_remove").dialog("close")}}]}),"function"==typeof e&&e(c)})}var d=void 0;return{openDialog:function(b){if(0==a(".overlay_dialog_remove").length)return void c(b,this.openDialog);d.clear().draw();var e=a(b).highcharts();e&&(a.each(e.series,function(b,c){c.options.isInstrument&&b>0&&"navigator"!==c.options.id&&a(d.row.add([c.options.name]).draw().node()).click(function(){a(this).toggleClass("selected")}).data({id:c.options.id})}),a(".overlay_dialog_remove").data("refererChartID",b).dialog("open"))}}});