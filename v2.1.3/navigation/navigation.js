define(["jquery","moment","text!navigation/navigation.html","css!navigation/navigation.css","common/util"],function(a,b,c){"use strict";function d(b){var c=a("#nav-menu"),d=a("#mobile-nav"),e=a("#nav-toggle"),f="nav-normal-menu",g="nav-mobile-menu";b.matches?d.is(":visible")||e.removeClass("nav-toggle-active"):(c.hasClass(g)&&c.removeClass(g).addClass(f),c.parents("#mobile-nav").length&&c.unwrap(),c.find("li > ul").each(function(){a(this).removeAttr("style")}))}function e(){var b=a("#nav-menu"),c="nav-normal-menu",d="nav-mobile-menu";b.hasClass(c)?(b.removeClass(c).addClass(d),b.wrap("<div id='mobile-nav'></div>"),a("#mobile-nav").animate({left:"+=280"},320)):b.hasClass(d)&&a("#mobile-nav").animate({left:"-=280"},320,function(){b.removeClass(d).addClass(c),b.unwrap()})}function f(){a("#nav-menu li > ul li").each(function(){var b=a(this);b.hasClass("update-list-item-handlers")||(b.addClass("update-list-item-handlers"),b.on("click",function(){var b="nav-normal-menu",c="nav-mobile-menu",d=a(this),f=d.parents("#nav-menu"),g=d.find("ul").length>0;f.hasClass(b)?g||d.parent("ul").not("#nav-menu").toggleClass("nav-closed"):f.hasClass(c)&&(g||a("#mobile-nav").animate({left:"-=280"},320,function(){a("#nav-toggle").removeClass("nav-toggle-active"),e()}))}))}),a("#nav-menu.nav-normal-menu li").each(function(){a(this).on("mouseover",function(){a(this).find("ul.nav-closed").each(function(){a(this).removeClass("nav-closed")})})})}function g(){a("#nav-menu a.nav-dropdown-toggle").each(function(){var b=a(this);b.hasClass("update-dropdown-toggle-handlers")||(b.addClass("update-dropdown-toggle-handlers"),b.on("click",function(c){var d=b.parent(),e=d.parent(),f="nav-menu"===e.attr("id"),g="nav-mobile-menu",h="submenu-expanded",i=b.parents("#nav-menu").hasClass(g);if(i){var j=b.next("ul");j.length>0&&(f&&a("#nav-menu.nav-mobile-menu li").each(function(){a(this).removeClass("active")}),a("#nav-menu li > ul").each(f?function(){a(this).slideUp()}:function(){var b=a(this);b.hasClass(h)||b.slideUp(),e.find("li > ul").each(function(){a(this).is(j)||a(this).slideUp()})}),f&&d.toggleClass("nav-toggle-active"),j.is(":visible")?(j.slideUp(),j.removeClass(h)):(j.slideDown(),j.addClass(h)))}c.preventDefault()}))}),f()}function h(c){var d=c.find(".login"),e=c.find(".account").hide(),f=c.find("span.time"),g=c.find(".login button"),h=c.find(".account .logout"),i=c.find(".account span.login-id"),j=c.find(".account span.balance").fadeOut(),k="";require(["websockets/binary_websockets"],function(b){function c(a){if(!k)return void b.send({payout_currencies:1}).then(function(b){k=b.payout_currencies[0],setTimeout(function(){c(a)},0)})["catch"](function(a){});var d="0";d=a.authorize?a.authorize.balance:a.balance.balance,j.text(k+" "+formatPrice(d)).fadeIn()}b.events.on("balance",c),b.events.on("logout",function(){a(".webtrader-dialog[data-authorized=true]").dialog("close").dialog("destroy").remove(),h.removeAttr("disabled"),e.fadeOut(),d.fadeIn(),i.fadeOut(),j.fadeOut(),k=""}),b.events.on("login",function(f){a(".webtrader-dialog[data-authorized=true]").dialog("close").dialog("destroy").remove(),d.fadeOut(),e.fadeIn(),c(f),i.text("Account "+f.authorize.loginid).fadeIn(),a(".account li.info").remove();var g=local_storage.get("oauth")||[];g.forEach(function(c){if(c.id!==f.authorize.loginid){var d=a('<a href="#"></a>').html('<span class="ui-icon ui-icon-login"></span>'+c.id),e=a("<li/>").append(d).addClass("info");e.data(c),e.click(function(){var c=a(this).data();a(".account li.info").remove(),b.switch_account(c.id)["catch"](function(b){a.growl.error({message:b.message})})}),e.insertBefore(h.parent())}})}),g.on("click",function(){g.attr("disabled","disabled"),require(["oauth/login"],function(a){g.removeAttr("disabled"),a.init()})}),h.on("click",function(){b.invalidate(),h.attr("disabled","disabled")})}),f.text(b.utc().format("YYYY-MM-DD HH:mm")+" GMT"),setInterval(function(){f.text(b.utc().format("YYYY-MM-DD HH:mm")+" GMT")},15e3)}return a(window).resize(function(){if(matchMedia){var a=window.matchMedia("(max-width: 699px)");a.addListener(d),d(a)}else{window.innerWidth>0?window.innerWidth:screen.width}}),{init:function(b){var d=a(c);a("body").prepend(d),h(d),require(["themes/themes"]),a("#nav-toggle").on("click",function(b){a("#nav-toggle").toggleClass("nav-toggle-active"),e(),b.preventDefault()}),g(),b&&b(a("#nav-menu")),is_beta()&&d.find("a.config").closest("li").show()},updateDropdownToggles:g}});