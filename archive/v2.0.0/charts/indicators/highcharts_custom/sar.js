define(["indicator_base","highstock"],function(a){var b={},c={};return{init:function(){!function(a,d,e){function f(a,d){{var f=this;f.chart}for(var g in c)if(c[g]&&c[g].options&&c[g].options.data&&c[g].options.data.length>0&&b[g].parentSeriesID==f.options.id){var h=f.options.data,i=b[g].period,j=e.findDataUpdatedDataPoint(h,a);if(j>=1){var k=0;if(j>=i){for(var l=0,m=0,n=j,o=1;n>0&&i>=o;n--,o++){var p=e.extractPrice(h,n-1),q=e.extractPrice(h,n);q>p&&(l+=q-p),p>q&&(m+=p-q)}l/=i,m/=i;var r=l/m;k=0==m?100:100-100/(1+r)}k=e.toFixed(k,2),d?c[g].options.data.length<h.length?c[g].addPoint([h[j].x||h[j][0],k]):c[g].data[j].update([h[j].x||h[j][0],k]):c[g].addPoint([h[j].x||h[j][0],k])}}}a&&!a.Series.prototype.addSAR&&(a.Series.prototype.addSAR=function(a){var f=this.options.id;a=d.extend({acceleration:.02,maximum:.2,stroke:"red",strokeWidth:2,dashStyle:"Dot",levels:[],parentSeriesID:f},a);var g="_"+(new Date).getTime(),h=this.options.data||[];if(h&&h.length>0){for(var j=[],k=0;k<h.length;k++)if(k>=6){if(0==j[k-1]){Math.min(e.extractPrice(h,i-1),e.extractPrice(h,i-2),e.extractPrice(h,i-3),e.extractPrice(h,i-4),e.extractPrice(h,i-5)),Math.max(e.extractPrice(h,i-1),e.extractPrice(h,i-2),e.extractPrice(h,i-3),e.extractPrice(h,i-4),e.extractPrice(h,i-5))}var l=0==avgLoss?100:100-100/(1+rs);isFinite(l)&&!isNaN(l)&&j.push([h[k].x||h[k][0],e.toFixed(l,4)])}else j.push([h[k].x||h[k][0],0]);var m=this.chart;b[g]=a,m.addAxis({id:"sar"+g,title:{text:"SAR("+a.acceleration+","+a.maximum+")",align:"high",offset:0,rotation:0,y:10,x:50},lineWidth:2},!1,!1,!1),e.recalculate(m);var n=this;c[g]=m.addSeries({id:g,name:"SAR("+a.acceleration+","+a.maximum+")",data:j,type:"line",dataGrouping:n.options.dataGrouping,yAxis:"sar"+g,opposite:n.options.opposite,color:a.stroke,lineWidth:a.strokeWidth,dashStyle:a.dashStyle},!1,!1),d(c[g]).data({isIndicator:!0,indicatorID:"sar",parentSeriesID:a.parentSeriesID,period:a.period}),m.redraw()}return g},a.Series.prototype.removeSAR=function(a){var d=this.chart;b[a]=null,d.get(a).remove(!1),d.get("sar"+a).remove(!1),c[a]=null,e.recalculate(d),d.redraw()},a.wrap(a.Series.prototype,"addPoint",function(a,c,d,g,h){a.call(this,c,d,g,h),e.checkCurrentSeriesHasIndicator(b,this.options.id)&&f.call(this,c)}),a.wrap(a.Point.prototype,"update",function(a,c,d,g){a.call(this,c,d,g),e.checkCurrentSeriesHasIndicator(b,this.series.options.id)&&f.call(this.series,c,!0)}))}(Highcharts,jQuery,a)}}});