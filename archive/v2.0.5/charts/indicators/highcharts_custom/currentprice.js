define(["indicator_base","highstock"],function(a){var b={};return{init:function(){!function(a,c,d){function e(){if(-1==this.options.name.indexOf("CurrentPrice")){var a=this,d=a.options.data[a.data.length-1],e=this.yAxis;return c.each(e.plotLinesAndBands,function(c,g){var h=g.options.id;if(h){var i=b[h.replace("CurrentPrice","")];if(i&&i.parentSeriesID==a.options.id){e.removePlotLine(h);var j=d.y||d.close||d[4]||d[1];f.call(a,h.replace("CurrentPrice",""),b[h.replace("CurrentPrice","")],j)}}}),!1}}function f(a,b,e){var f=this.chart.series.length+1,g=!1;this.data[this.data.length-1]&&(c.isNumeric(this.data[this.data.length-1].change)&&(g=!0,e=d.toFixed(this.data[this.data.length-1].change,2)),this.yAxis.addPlotLine({id:"CurrentPrice"+a,color:b.stroke,dashStyle:b.dashStyle,width:b.strokeWidth,value:e,zIndex:f,label:{text:'<div style="background-color: #2ECC71; border-radius: 2px;">'+e+(g?"%":"")+"</div>",x:-40,y:4,useHTML:!0}}))}a&&!a.Series.prototype.addCurrentPrice&&(a.Series.prototype.addCurrentPrice=function(a){var d=this.options.id;a=c.extend({stroke:"red",strokeWidth:1,dashStyle:"dash",parentSeriesID:d},a);var e="_"+(new Date).getTime(),g=this.data||[];if(g&&g.length>0){b[e]=a;var h=g[g.length-1],i=h.y||h.close||h[4];i>0&&f.call(this,e,a,i)}return e},a.Series.prototype.removeCurrentPrice=function(a){b[a]=null,this.yAxis.removePlotLine("CurrentPrice"+a)},a.wrap(a.Series.prototype,"addPoint",function(a,b,c,d,f){a.call(this,b,c,d,f),e.call(this,b)}),a.wrap(a.Point.prototype,"update",function(a,b,c,d){a.call(this,b,c,d);var f=this.series;e.call(f,b,!0)}))}(Highcharts,jQuery,a)},getCurrentPriceOptions:function(){return b}}});