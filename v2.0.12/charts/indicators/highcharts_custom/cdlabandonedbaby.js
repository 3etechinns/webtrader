define(["indicator_base","highstock"],function(a){function b(b,c){var d=c,f=c-1,g=c-2,h=a.extractPriceForAppliedTO(a.OPEN,b,g),i=a.extractPriceForAppliedTO(a.CLOSE,b,g),j=a.extractPriceForAppliedTO(a.HIGH,b,g),k=a.extractPriceForAppliedTO(a.LOW,b,g),l=a.extractPriceForAppliedTO(a.OPEN,b,f),m=a.extractPriceForAppliedTO(a.CLOSE,b,f),n=a.extractPriceForAppliedTO(a.HIGH,b,f),o=a.extractPriceForAppliedTO(a.LOW,b,f),p=a.extractPriceForAppliedTO(a.OPEN,b,d),q=a.extractPriceForAppliedTO(a.CLOSE,b,d),r=a.extractPriceForAppliedTO(a.LOW,b,d),s=a.extractPriceForAppliedTO(a.HIGH,b,d),t=i>h,u=h>i,v=q>p,w=p>q,x=a.isDoji({open:l,high:n,low:o,close:m}),y=t&&Math.abs(i-h)>e&&x.isBear&&o>j&&w&&Math.abs(q-p)>e&&o>s,z=u&&Math.abs(i-h)>e&&x.isBull&&k>n&&v&&Math.abs(q-p)>e&&r>n;return{isBullishContinuation:z,isBearishContinuation:y}}var c={},d={},e=0;return{init:function(){!function(a,f,g){function h(a,e){var f=this,h=f.chart;for(var i in d)if(d[i]&&d[i].options&&d[i].options.data&&d[i].options.data.length>0&&c[i].parentSeriesID==f.options.id&&d[i].chart===h){var j=f.options.data,k=(c[i].period,g.findIndexInDataForTime(j,a));if(k>=1){var l=b(j,k),m=null;l.isBullishContinuation?m={x:j[k].x||j[k][0],title:'<span style="color : blue">AB</span>',text:"Abandoned Baby : Bull"}:l.isBearishContinuation&&(m={x:j[k].x||j[k][0],title:'<span style="color : red">AB</span>',text:"Abandoned Baby : Bear"});for(var n=-1,o=d[i].data.length-1;o>=0;o--)if((d[i].data[o].x||d[i].data[o][0])==(j[k].x||j[k][0])){n=o;break}m?(e&&n>=0&&d[i].data[n].remove(),d[i].addPoint(m)):n>=0&&d[i].data[n].remove()}}}a&&!a.Series.prototype.addCDLABANDONEDBABY&&(a.Series.prototype.addCDLABANDONEDBABY=function(a){var h=this.options.id;a=f.extend({parentSeriesID:h},a);var i="_"+(new Date).getTime(),j=this.options.data||[];if(j&&j.length>0){e=g.getCandleMediumHeight(j);for(var k=[],l=2;l<j.length;l++){var m=b(j,l),n=m.isBullishContinuation,o=m.isBearishContinuation;n&&k.push({x:j[l].x||j[l][0],title:'<span style="color : blue">AB</span>',text:"Abandoned Baby : Bull"}),o&&k.push({x:j[l].x||j[l][0],title:'<span style="color : red">AB</span>',text:"Abandoned Bay : Bear"})}var p=this.chart;c[i]=a;d[i]=p.addSeries({id:i,name:"CDLABANDONEDBABY",data:k,type:"flags",onSeries:h,shape:"flag",turboThreshold:0},!1,!1),f(d[i]).data({isIndicator:!0,indicatorID:"cdlabandonedbaby",parentSeriesID:a.parentSeriesID}),p.redraw()}return i},a.Series.prototype.removeCDLABANDONEDBABY=function(a){var b=this.chart;c[a]=null,b.get(a).remove(!1),d[a]=null,b.redraw()},a.Series.prototype.preRemovalCheckCDLABANDONEDBABY=function(a){return{isMainIndicator:!0,isValidUniqueID:null!=c[a]}},a.wrap(a.Series.prototype,"addPoint",function(a,b,d,e,f){a.call(this,b,d,e,f),g.checkCurrentSeriesHasIndicator(c,this.options.id)&&h.call(this,b[0])}),a.wrap(a.Point.prototype,"update",function(a,b,d,e){a.call(this,b,d,e),g.checkCurrentSeriesHasIndicator(c,this.series.options.id)&&h.call(this.series,this.x,!0)}))}(Highcharts,jQuery,a)}}});