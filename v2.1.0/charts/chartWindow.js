define(["jquery","windows/windows","text!charts/chartWindow.html","lodash","jquery.dialogextend"],function(a,b,c,d){"use strict";function e(){a(this).find(".chartSubContainer").width(a(this).width()-10),a(this).find(".chartSubContainer").height(a(this).height()-15);var b="#"+a(this).find(".chartSubContainer").attr("id");require(["charts/charts"],function(a){a.triggerReflow(b)})}return{addNewWindow:function(f){f=a.extend({title:f.instrumentName+" ("+f.timePeriod+")",close:function(){var b=a(this).attr("id"),c=a("#"+b+"_chart"),e=c.data("timePeriod"),f=c.data("instrumentCode");a(this).dialog("destroy"),require(["charts/charts"],function(a){a.destroy({containerIDWithHash:"#"+b+"_chart",timePeriod:e,instrumentCode:f})});var g=local_storage.get("windows")||{},h=d.findIndex(g.windows,function(a){return a.isChart&&a.instrumentCode===f&&a.timePeriod===e});h>=0&&(g.windows.splice(h,1),local_storage.set("windows",g))},resize:e},f);var g=b.createBlankWindow(c,f),h=g.attr("id");return g.find("div.chartSubContainerHeader").attr("id",h+"_header").end().find("div.chartSubContainer").attr("id",h+"_chart").end(),require(["charts/charts"],function(a){a.drawChart("#"+h+"_chart",f,f.resize.bind(g)),require(["charts/chartOptions","charts/tableView"],function(a,b){var c=b.init(g);a.init(h,f.timePeriod,f.type,c.show)})}),g.dialog("open"),g},totalWindows:function(){return a("div.webtrader-dialog").length},triggerResizeEffects:function(a){e.call(a)}}});