define(["exports","babel-runtime/regenerator","jquery","../windows/windows","../common/rivetsExtra","lodash","text!./index.html","websockets/binary_websockets","websockets/validateToken","../instruments/instruments","css!./index.css","../common/util"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a){return a&&a.__esModule?a:{"default":a}}function l(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(i){return void c(i)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),a.init=void 0;var m=k(b),n=k(c),o=k(d),p=k(e),q=k(f),r=k(g),s=k(h),t=k(i),u=[{code:"CALL",name:"Rise/Higher"},{code:"PUT",name:"Fall/Lower"},{code:"ONETOUCH",name:"Touch"},{code:"NOTOUCH",name:"NoTouch"},{code:"EXPIRYMISS",name:"Ends Out"},{code:"EXPIRYRANGE",name:"Ends In"},{code:"DIGITDIFF",name:"Digits Differ"},{code:"DIGITMATCH",name:"Digits Match"},{code:"DIGITOVER",name:"Digits Over"},{code:"DIGITUNDER",name:"Digits Under"},{code:"DIGITODD",name:"Digits Odd"},{code:"DIGITEVEN",name:"Digits Even"},{code:"ASIANU",name:"Asians Up"},{code:"ASIAND",name:"Asians Down"}],v="copyTrade",w=u.slice(0,2).map(function(a){return a.code}),x=function(a){return{copy_start:a,min_trade_stake:10,max_trade_stake:100,assets:q["default"].cloneDeep(C),trade_types:q["default"].cloneDeep(w)}},y=function(a,b){return{open:!1,started:!1,disableStart:!1,loginid:b,yourCopySettings:x(a)}},z=function(a){var b=!1,c="";return a?a.assets&&a.assets.length>0?a.trade_types&&a.trade_types.length>0?a.min_trade_stake>=1&&a.min_trade_stake<=5e4?a.max_trade_stake>=1&&a.max_trade_stake<=5e4?a.min_trade_stake<a.max_trade_stake?b=!0:c="Min Trade Stake cannot be more than or equal to Max Trader stake":c="Max Trade Stake should between 1 and 50000":c="Min Trade Stake should between 1 and 50000":c="Trade types required":c="Assets required":c="Enter valid values for copy settings",c&&n["default"].growl.error({message:c}),b},A=q["default"].debounce(function(a){var b=q["default"].cloneDeep(a);delete b.searchToken.disable,local_storage.set(v,b)},50),B=null,C=null;j.init().then(function(a){B=q["default"].flatten(a.map(function(a){var b=a.display_name;return a.submarkets.map(function(a){return{displayName:b+" - "+a.display_name,instruments:a.instruments}})}));var b=[];a.forEach(function(a){a.submarkets.forEach(function(a){a.instruments.forEach(function(a){var c=a.symbol,d=a.display_name;b.push({code:c,name:d})})})}),G.masterAssetList=b,G.groupedAssets=B,C=b.filter(function(a){return"R_10"===a.code}).map(function(a){return a.code})});var D=function(a,b,c){return s["default"].send({copytrading_statistics:1,trader_id:a}).then(function(d){if(d.copytrading_statistics){var e=q["default"].find(c.traderTokens,function(a){return a.yourCopySettings&&a.yourCopySettings.copy_start===b});e?q["default"].merge(e.traderStatistics,d.copytrading_statistics):c.traderTokens.push(q["default"].merge({traderStatistics:d.copytrading_statistics},y(b,a)))}A(c)})},E=null,F=null,G={masterAssetList:[],masterTradeTypeList:q["default"].cloneDeep(u),groupedAssets:[],allowCopy:{allow_copiers:!1,onAllowCopyChange:q["default"].debounce(function(a,b){s["default"].send({set_settings:1,allow_copiers:+b.allowCopy.allow_copiers})["catch"](function(a){n["default"].growl.error({message:a.message}),b.allowCopy.allow_copiers=!b.allowCopy.allow_copiers})},250)},onOpenChange:function(a){G.traderTokens[a].open=!G.traderTokens[a].open},onStartedChange:function(a){G.traderTokens[a].disableStart=!0;var b=!G.traderTokens[a].started;if(b){var c=local_storage.get(v);if(c){var d=c.traderTokens[a];if(d){var e={};q["default"].merge(e,G.traderTokens[a],d),G.traderTokens.splice(a,1),q["default"].defer(function(){G.traderTokens.splice(a,0,e),s["default"].send(e.yourCopySettings).then(function(){e.disableStart=!1,e.started=!0,A(G)})["catch"](function(a){n["default"].growl.error({message:a.message}),e.disableStart=!1,A(G)})})}}}else s["default"].send({copy_stop:G.traderTokens[a].yourCopySettings.copy_start}).then(function(){G.traderTokens[a].disableStart=!1,G.traderTokens[a].started=!1,A(G)})["catch"](function(b){n["default"].growl.error({message:b.message}),G.traderTokens[a].disableStart=!1,A(G)})},onRemove:function(a){var b=G.traderTokens[a];G.traderTokens.splice(a,1),A(G),s["default"].send({copy_stop:b.yourCopySettings.copy_start})["catch"](function(){})},onRefresh:function(a){var b=G.traderTokens[a],c=b.loginid,d=b.yourCopySettings.copy_start;c&&d&&(b.disableRefresh=!0,D(c,d,G).then(function(){b.disableRefresh=!1,A(G)})["catch"](function(a){n["default"].growl.error({message:"Refresh failed"}),b.disableRefresh=!1,A(scope)}))},onMinTradeChange:function(a,b){var c=n["default"](a.target).data("index"),d=a.target.value;isNaN(parseInt(d))||(b.traderTokens[c].yourCopySettings.min_trade_stake=parseInt(d))},onMaxTradeChange:function(a,b){var c=n["default"](a.target).data("index"),d=a.target.value;b.traderTokens[c].yourCopySettings.max_trade_stake=d},onUpdateYourSettings:function(a){z(G.traderTokens[a].yourCopySettings)&&(G.traderTokens[a].yourCopySettings.min_trade_stake=parseInt(G.traderTokens[a].yourCopySettings.min_trade_stake),G.traderTokens[a].yourCopySettings.max_trade_stake=parseInt(G.traderTokens[a].yourCopySettings.max_trade_stake),A(G),n["default"].growl.notice({message:"Updated successfully"}))},searchToken:{token:"",onTokenChange:function(a,b){return b.searchToken.token=a.target.value},disable:!1,onKeyDown:function(a,b){13===a.keyCode&&b.searchToken.addToken(a,b)},addToken:function(a,b){return b.searchToken.token?(b.searchToken.disable=!0,void t["default"](b.searchToken.token).then(function(c){D(c.loginid,b.searchToken.token,b).then(function(){b.searchToken.token="",b.searchToken.disable=!1,A(b)})["catch"](function(c){n["default"].growl.error({message:c.message}),b.searchToken.disable=!1,A(b),q["default"].defer(function(){return n["default"](a.target).focus()})})})["catch"](function(a){n["default"].growl.error({message:a.message}),b.searchToken.disable=!1,A(b)})):void n["default"].growl.error({message:"Enter a valid trader token"})}},traderTokens:[]},H=function(){var a=n["default"](r["default"]).i18n();F=p["default"].bind(a[0],G),E=o["default"].createBlankWindow(a,{title:"Copy Trade".i18n(),resizable:!0,collapsable:!0,minimizable:!0,maximizable:!0,modal:!1,width:600,open:function(){var a=local_storage.get(v);a&&(q["default"].merge(G,a),G.traderTokens=q["default"].cloneDeep(G.traderTokens)),s["default"].send({get_settings:1}).then(function(a){var b=a.get_settings,c=void 0===b?{}:b;return G.allowCopy.allow_copiers=1===c.allow_copiers}),a&&l(m["default"].mark(function b(){var c,d,e,f,g,h,i,j;return m["default"].wrap(function(b){for(;;)switch(b.prev=b.next){case 0:c=!0,d=!1,e=void 0,b.prev=3,f=a.traderTokens[Symbol.iterator]();case 5:if(c=(g=f.next()).done){b.next=20;break}return h=g.value,b.prev=7,i=h.loginid,j=h.yourCopySettings.copy_start,b.next=12,D(i,j,G);case 12:b.next=17;break;case 14:b.prev=14,b.t0=b["catch"](7);case 17:c=!0,b.next=5;break;case 20:b.next=26;break;case 22:b.prev=22,b.t1=b["catch"](3),d=!0,e=b.t1;case 26:b.prev=26,b.prev=27,!c&&f["return"]&&f["return"]();case 29:if(b.prev=29,!d){b.next=32;break}throw e;case 32:return b.finish(29);case 33:return b.finish(26);case 34:case"end":return b.stop()}},b,this,[[3,22,26,34],[7,14],[27,,29,33]])}))()},close:function(){F&&F.unbind(),E&&E.dialog("destroy").remove(),F=E=null},"data-authorized":"true"}),E.track({module_id:"copyTrade",is_unique:!0,data:null}),E.dialog("open")},I=a.init=function(a){a.click(function(){E?E.moveToTop():H()})};a["default"]={init:I}});